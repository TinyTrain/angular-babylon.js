(function(){"use strict";function e(e){function a(e,a){var r=new BABYLON.ArcRotateCamera("ArcRotateCamera",1,1,4e3,new BABYLON.Vector3.Zero,a);r.setTarget(BABYLON.Vector3.Zero()),r.attachControl(e,!1);var t=function(){r.beta<.1?r.beta=.1:r.beta>Math.PI/2*1&&(r.beta=Math.PI/2*1),r.radius>4e3&&(r.radius=4e3),r.radius<30&&(r.radius=30)};a.registerBeforeRender(t),w=r}function r(e){var a=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(1,1,0),e);a.diffuse=new BABYLON.Color3(1,1,1),a.specular=new BABYLON.Color3(1,1,1),a.groundColor=new BABYLON.Color3(0,0,0),a.range=300}function t(e,a,r,t){var n=new BABYLON.DynamicTexture("DynamicTexture",{width:300,height:100},t,!0);n.hasAlpha=!0,n.drawText(e,5,40,"36px Arial",a,"transparent",!0);var i=BABYLON.Mesh.CreatePlane("TextPlane",r,t,!0);return i.material=new BABYLON.StandardMaterial("TextPlaneMaterial",t),i.material.backFaceCulling=!1,i.material.specularColor=new BABYLON.Color3(1,0,0),i.material.diffuseTexture=n,i}function n(e,a){return e/Math.sqrt(1+Math.pow(a,2))}function i(e,a){return e*a/Math.sqrt(Math.pow(a,2)+1)}function o(e,a){var r=BABYLON.Mesh.CreateGroundFromHeightMap("ground","textures/aaa.png",5e3,5e3,600,-44,350,a,!1,function(e){},function(e){}),t=new BABYLON.StandardMaterial("groundMaterial",a);return t.diffuseTexture=new BABYLON.Texture("textures/guilin_baidu_map.png",a),t.specularColor=new BABYLON.Color3(0,0,0),r.position.y=0,r.material=t,r}function h(e,a,r,t){var n=BABYLON.MeshBuilder.CreateGround("runway",{width:a/830*400,height:a,subdivsions:1},t),i=new BABYLON.StandardMaterial("ground",t);return i.diffuseTexture=new BABYLON.Texture("textures/tube_airport_map2.png",t),i.backFaceCulling=!1,i.specularColor=new BABYLON.Color3(0,0,0),n.position.x=30,n.rotation.y=-Math.PI/180/60/60*19464,n.material=i,n}function s(e,a,r,t){var n={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius};console.log("innerSurfaceParam:",n);var i=BABYLON.MeshBuilder.CreateCylinder("innerSurface",{height:n.height,diameterTop:n.diameterTop,diameterBottom:n.diameterBottom,tessellation:64,arc:.5,updatable:!1},t),o=new BABYLON.StandardMaterial("innerSurfaceMaterial",t);o.diffuseColor=new BABYLON.Color3(1,1,1),o.alpha=.6,i.position.y=n.height/2,o.wireframe=r,o.specularColor=new BABYLON.Color3(0,0,0);var h=i.clone(" halfInnerSurface2");h.rotation.y=Math.PI,i.position.z=-a/2,h.position.z=a/2;var s=[[new BABYLON.Vector3(n.diameterBottom/2,0,a/2),new BABYLON.Vector3(n.diameterTop/2,n.height,a/2),new BABYLON.Vector3(-n.diameterTop/2,n.height,a/2),new BABYLON.Vector3(-n.diameterTop/2,0,a/2)],[new BABYLON.Vector3(n.diameterBottom/2,0,-a/2),new BABYLON.Vector3(n.diameterTop/2,n.height,-a/2),new BABYLON.Vector3(-n.diameterTop/2,n.height,-a/2),new BABYLON.Vector3(-n.diameterTop/2,0,-a/2)]],B=BABYLON.MeshBuilder.CreateRibbon("innerSurfaceMiddle",{pathArray:s,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);B.wireframe=r;var l=BABYLON.Mesh.MergeMeshes([i,B,h]);return l.material=o,l}function B(e,a,r,t,n){var i={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius},o={height:a.height,diameterTop:i.diameterTop+a.height/a.slope*2,diameterBottom:i.diameterTop};console.log("cylinderParam:",o);var h=BABYLON.MeshBuilder.CreateCylinder("halfCylinder1",{height:o.height,diameterTop:o.diameterTop,diameterBottom:o.diameterBottom,tessellation:64,arc:.5,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n),s=new BABYLON.StandardMaterial("cylinderMaterial",n);s.diffuseColor=new BABYLON.Color3(210/255,105/255,30/255),s.alpha=.6,s.specularColor=new BABYLON.Color3(0,0,0),s.wireframe=t,h.position.y=i.height+o.height/2;var B=h.clone("halfCylinder2");B.rotation.y=Math.PI,h.position.z=-r/2,B.position.z=r/2;var l=[[new BABYLON.Vector3(o.diameterBottom/2,i.height,r/2),new BABYLON.Vector3(o.diameterBottom/2,i.height,-r/2)],[new BABYLON.Vector3(o.diameterTop/2,i.height+o.height,r/2),new BABYLON.Vector3(o.diameterTop/2,i.height+o.height,-r/2)],[new BABYLON.Vector3(-o.diameterTop/2,i.height+o.height,r/2),new BABYLON.Vector3(-o.diameterTop/2,i.height+o.height,-r/2)],[new BABYLON.Vector3(-o.diameterBottom/2,i.height,r/2),new BABYLON.Vector3(-o.diameterBottom/2,i.height,-r/2)]],p=BABYLON.MeshBuilder.CreateRibbon("cylinderSide",{pathArray:l,sideOrientation:BABYLON.Mesh.DOUBLESIDE,closeArray:!0},n),d=BABYLON.Mesh.MergeMeshes([h,p,B]);return d.material=s,d}function l(e,a,r){var t=a/2+e.distance,o=a/2+e.distance+n(e.length,e.slope),h=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2,i(e.length,e.slope),r?o:r-o)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-e.innerWidth/2,i(e.length,e.slope),r?o:r-o)]];return console.log("innerApproachSurfacePaths:",h),h}function p(e,a,r,t,n){var i=l(e,a,0),o=l(e,a,1),h=new BABYLON.StandardMaterial("innerApproachSurfaceMateria1",t);h.diffuseColor=new BABYLON.Color3(128/255,0,0),h.alpha=.6,h.specularColor=new BABYLON.Color3(0,0,0);var s=BABYLON.MeshBuilder.CreateRibbon("innerApproachSurface1",{pathArray:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);s.material=h;var B=BABYLON.MeshBuilder.CreateRibbon("innerApproachSurface2",{pathArray:o,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);return B.material=h,[s,B]}function d(e,a,r){console.log("approachSurfaceRef",e);var t=a/2+e.distance,o=a/2+e.distance+n(e.phase1.length,e.phase1.slope),h=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,i(e.phase1.length,e.phase1.slope),r?o:r-o)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),i(e.phase1.length,e.phase1.slope),r?o:r-o)]],s=a/2+e.distance+n(e.phase1.length,e.phase1.slope),B=a/2+e.distance+n(e.phase1.length,e.phase1.slope)+n(e.phase2.length,e.phase2.slope),l=[[new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,i(e.phase1.length,e.phase1.slope),r?s:r-s),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate,i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope),r?B:r-B)],[new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),i(e.phase1.length,e.phase1.slope),r?s:r-s),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate),i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope),r?B:r-B)]],p=a/2+e.distance+n(e.phase1.length,e.phase1.slope)+n(e.phase2.length,e.phase2.slope),d=a/2+e.distance+n(e.phase1.length,e.phase1.slope)+n(e.phase2.length,e.phase2.slope)+n(e.phase3.length,e.phase3.slope);return[h,l,[[new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate,i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope),r?p:r-p),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate+e.phase3.length*e.dispersalRate,i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope)+i(e.phase3.length,e.phase3.slope),r?d:r-d)],[new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate),i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope),r?p:r-p),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate+e.phase3.length*e.dispersalRate),i(e.phase1.length,e.phase1.slope)+i(e.phase2.length,e.phase2.slope)+i(e.phase3.length,e.phase3.slope),r?d:r-d)]]]}function c(e,a,r,n){var i=d(e,a,0),o=d(e,a,1),h=new BABYLON.StandardMaterial("approachSurfacePhase1Materia1",n);h.diffuseColor=new BABYLON.Color3(1,105/255,180/255),h.alpha=.6,h.wireframe=r,h.specularColor=new BABYLON.Color3(0,0,0);var s=new BABYLON.StandardMaterial("approachSurfacePhase2Material",n);s.diffuseColor=new BABYLON.Color3(1,105/255,180/255),s.alpha=.6,s.wireframe=r,s.specularColor=new BABYLON.Color3(0,0,0);var B=new BABYLON.StandardMaterial("approachSurfacePhase3Materia",n);B.diffuseColor=new BABYLON.Color3(1,105/255,180/255),B.alpha=.6,B.wireframe=r,B.specularColor=new BABYLON.Color3(0,0,0);var l=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase1",{pathArray:i[0],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);l.material=h;var p=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase2",{pathArray:i[1],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);p.material=s;var c=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase3",{pathArray:i[2],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);c.material=B;var u=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase1",{pathArray:o[0],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);u.material=h;var A=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase2",{pathArray:o[1],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);A.material=s;var O=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase3",{pathArray:o[2],sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);return O.material=B,t("近进面","red",100,n).position=new BABYLON.Vector3(0,e.phase1.length*e.phase1.slope+e.phase2.length*e.phase2.slope,a/2+e.distance+e.phase1.length+e.phase2.length),[[l,p,c],[u,A,O]]}function u(e,a,r,t){var n=[[new BABYLON.Vector3(e.innerWidth/2,0,a/2+e.distance),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,e.phase1.length*e.phase1.slope,a/2+e.distance+e.phase1.length),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),e.phase1.length*e.phase1.slope,a/2+e.distance+e.phase1.length),new BABYLON.Vector3(-e.innerWidth/2,0,a/2+e.distance)],[new BABYLON.Vector3(e.innerWidth/2,0,-(a/2+e.distance)),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,e.phase1.length*e.phase1.slope,-(a/2+e.distance+e.phase1.length)),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),e.phase1.length*e.phase1.slope,-(a/2+e.distance+e.phase1.length)),new BABYLON.Vector3(-e.innerWidth/2,0,-(a/2+e.distance))]],i=BABYLON.MeshBuilder.CreateRibbon("transitionalSurface",{pathArray:n,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t),o=new BABYLON.StandardMaterial("transitionalSurfaceMaterial",t);return o.diffuseColor=new BABYLON.Color3(34/255,139/255,34/255),o.alpha=.6,o.specularColor=new BABYLON.Color3(0,0,0),i.material=o,i.wireframe=r,i}function A(e,a,r,t){var n=r/2+a.distance,i=e.diameterTop,o=[[new BABYLON.Vector3(a.innerWidth/2,0,t?n:t-n),new BABYLON.Vector3(a.innerWidth/2+e.height/a.dispersalRate,e.height,t?i:t-i)],[new BABYLON.Vector3(-a.innerWidth/2,0,t?n:t-n),new BABYLON.Vector3(-(a.innerWidth/2+e.height/a.dispersalRate),e.height,t?i:t-i)]];return console.log("reFlySurfacePaths:",o),o}function O(e,a,r,n,i){var o={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius},h=A(o,a,r,0),s=A(o,a,r,1),B=new BABYLON.StandardMaterial("reFlySurfaceMateria1",i);B.diffuseColor=new BABYLON.Color3(128/255,0,0),B.alpha=.6,B.specularColor=new BABYLON.Color3(0,0,0),B.wireframe=n;var l=BABYLON.MeshBuilder.CreateRibbon("reFlySurface1",{pathArray:h,sideOrientation:BABYLON.Mesh.DOUBLESIDE},i);l.material=B;var p=BABYLON.MeshBuilder.CreateRibbon("reFlySurface2",{pathArray:s,sideOrientation:BABYLON.Mesh.DOUBLESIDE},i);return p.material=B,t("复飞面","red",100,i).position=new BABYLON.Vector3(0,o.height,-o.diameterTop),[l,p]}function L(e,a,r){var t=a/2+e.distance,o=a/2+e.distance+n(e.length,e.slope),h=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2+e.length*e.dispersalRate,i(e.length,e.slope),r?o:r-o)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-(e.innerWidth/2+e.length*e.dispersalRate),i(e.length,e.slope),r?o:r-o)]];return console.log("flySurfacePaths:",h),h}function Y(e,a,r,n){var i=L(e,a,0),o=L(e,a,1),h=new BABYLON.StandardMaterial("flySurfaceMateria1",n);h.diffuseColor=new BABYLON.Color3(1,160/255,122/255),h.alpha=.6,h.specularColor=new BABYLON.Color3(0,0,0),h.wireframe=r;var s=BABYLON.MeshBuilder.CreateRibbon("flySurface",{pathArray:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);s.material=h;var B=BABYLON.MeshBuilder.CreateRibbon("flySurface",{pathArray:o,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);return B.material=h,t("起飞爬升面","red",100,n).position=new BABYLON.Vector3(0,e.length*e.slope,-(a/2+e.distance+e.length)),[s,B]}var N,g,w;return{createScene:function(t,n){var i=new BABYLON.Scene(n);return n.enableOfflineSupport=!1,N=i,g=n,a(t,i),r(i),e(i),i},makeTextPlane:t,createGround:o,createRunway:h,createInnerHorizontalSurface:s,createCylinderSurface:B,createInnerApproachSurfaces:p,createApproachSurfaces:c,createTransitionalSurfaces:u,createReflySurfaces:O,createFlySurfaces:Y}}angular.module("ngBabylonjs",[]).factory("LimitedScene",e),e.$inject=["SkyBox"]})();
