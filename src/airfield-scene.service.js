(function(){"use strict";function e(e,a,r){function t(e,a){(C=new BABYLON.ArcRotateCamera("ArcRotateCamera",1,.8,1e3,new BABYLON.Vector3(0,-1,0),a)).attachControl(e,!1),C.wheelPrecision=2;var r=function(){C.beta<.1?C.beta=.1:C.beta>Math.PI/1.5*1&&(C.beta=Math.PI/1.5*1),C.radius>4e3&&(C.radius=4e3),C.radius<10&&(C.radius=10)};a.registerBeforeRender(r)}function n(e){(a=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),e)).diffuse=new BABYLON.Color3(1,1,1),a.specular=new BABYLON.Color3(1,1,1),a.groundColor=new BABYLON.Color3(0,0,0),a.range=300;var a=new BABYLON.PointLight("Omni",new BABYLON.Vector3(0,6,0),e)}function i(e){for(var a=35;a<=315;a+=5)new BABYLON.WorldSpaceCanvas2D(e,new BABYLON.Size(80,40),{id:"WorldSpaceCanvas",worldPosition:new BABYLON.Vector3(-700,0,20*(a-35)-2800),worldRotation:BABYLON.Quaternion.RotationYawPitchRoll(0,Math.PI/2,Math.PI/2),backgroundFill:"#C0C0C040",children:[new BABYLON.Text2D("P"+a,{fontName:"26pt Arial",marginAlignment:"h: center, v: bottom"})]});for(var r=35;r<=105;r+=5)new BABYLON.WorldSpaceCanvas2D(e,new BABYLON.Size(80,40),{id:"WorldSpaceCanvas",worldPosition:new BABYLON.Vector3(20*(r-35)-700,0,-2800),worldRotation:BABYLON.Quaternion.RotationYawPitchRoll(0,Math.PI/2,Math.PI/2),backgroundFill:"#C0C0C040",children:[new BABYLON.Text2D("H"+r,{fontName:"26pt Arial",marginAlignment:"h: center, v: bottom"})]})}function o(e){var a=[];a.push(new BABYLON.Vector3(-430,0,-1200)),a.push(new BABYLON.Vector3(-430,0,700)),a.push(new BABYLON.Vector3(-500,0,700)),a.push(new BABYLON.Vector3(-500,0,2e3)),a.push(new BABYLON.Vector3(-200,0,2e3)),a.push(new BABYLON.Vector3(-200,0,1930)),a.push(new BABYLON.Vector3(-60,0,1930)),a.push(new BABYLON.Vector3(-60,0,1530)),a.push(new BABYLON.Vector3(60,0,1530)),a.push(new BABYLON.Vector3(60,0,1410)),a.push(new BABYLON.Vector3(750,0,1410)),a.push(new BABYLON.Vector3(750,0,690)),a.push(new BABYLON.Vector3(810,0,690)),a.push(new BABYLON.Vector3(810,0,535)),a.push(new BABYLON.Vector3(750,0,535)),a.push(new BABYLON.Vector3(750,0,90)),a.push(new BABYLON.Vector3(810,0,90)),a.push(new BABYLON.Vector3(810,0,-80)),a.push(new BABYLON.Vector3(750,0,-80)),a.push(new BABYLON.Vector3(750,0,-450)),a.push(new BABYLON.Vector3(880,0,-450)),a.push(new BABYLON.Vector3(880,0,-770)),a.push(new BABYLON.Vector3(750,0,-770)),a.push(new BABYLON.Vector3(750,0,-710)),a.push(new BABYLON.Vector3(600,0,-710)),a.push(new BABYLON.Vector3(600,0,-650)),a.push(new BABYLON.Vector3(-60,0,-650)),a.push(new BABYLON.Vector3(-60,0,-2e3)),a.push(new BABYLON.Vector3(-500,0,-2e3)),a.push(new BABYLON.Vector3(-500,0,-1200)),a.push(new BABYLON.Vector3(-430,0,-1200)),BABYLON.MeshBuilder.CreateDashedLines("dl",{points:a,dashSize:80,gapSize:20},e).color=BABYLON.Color3.Blue()}function B(a,r){var t=new BABYLON.Path2(170,990);t.addArcTo(165,1005,150,1010,100),t.addLineTo(-70,1010),t.addArcTo(-85,1005,-90,990,100),t.addLineTo(-90,150),t.addArcTo(-85,135,-70,130,100),t.addLineTo(280,130),t.addArcTo(295,125,305,110,100),t.addLineTo(305,-410),t.addArcTo(300,-425,285,-430,100),t.addLineTo(-70,-430),t.addArcTo(-85,-435,-90,-450,100),t.addLineTo(-90,-1530),t.addArcTo(-95,-1535,-110,-1540,100),t.addLineTo(-305,-1540),t.addLineTo(-305,-1600),t.addLineTo(-350,-1600),t.addLineTo(-350,1600),t.addLineTo(-305,1600),t.addLineTo(-305,1540),t.addLineTo(-305,1540),t.addArcTo(-270,1580,-205,1600,100),t.addLineTo(-110,1600),t.addArcTo(-95,1595,-90,1580,100),t.addLineTo(-90,1045),t.addArcTo(-85,1030,-70,1025,100),t.addLineTo(150,1025),t.addArcTo(165,1030,170,1045,100);var n=new BABYLON.Vector2(-140,-965),i=new BABYLON.Vector2(-120,-965),o=new BABYLON.Vector2(-120,-985),B=new BABYLON.Path2(n.x+25,n.y-5);B.addLineTo(n.x+25,n.y-20),B.addLineTo(i.x+5,i.y-20),B.addLineTo(i.x-20,i.y),B.addArcTo(o.x-10,o.y+30,o.x+5,o.y+20,100);var s=new BABYLON.Vector2(-275,-1445),h=new BABYLON.Vector2(-145,-1445),l=new BABYLON.Path2(s.x,s.y+60);l.addArcTo(s.x-30,s.y,s.x,s.y-60,100),l.addLineTo(h.x,h.y-60),l.addArcTo(h.x+30,h.y,h.x,h.y+60,100);var d=new BABYLON.Vector2(110,-375),p=new BABYLON.Vector2(-70,-375),c=new BABYLON.Vector2(-70,75),A=new BABYLON.Vector2(110,75),O=new BABYLON.Path2(d.x+20,d.y);O.addArcTo(d.x+15,d.y-15,d.x,d.y-20,100),O.addLineTo(p.x,p.y-20),O.addArcTo(p.x-15,p.y-15,p.x-20,p.y,100),O.addLineTo(c.x-20,c.y),O.addArcTo(c.x-15,c.y+15,c.x,c.y+20,100),O.addLineTo(A.x,A.y+20),O.addArcTo(A.x+15,A.y+15,A.x+20,A.y,100);var L=new BABYLON.Vector2(-135,-375),u=new BABYLON.Vector2(-285,-375),N=new BABYLON.Vector2(-285,75),Y=new BABYLON.Vector2(-135,75),g=new BABYLON.Path2(L.x+20,L.y);g.addArcTo(L.x+15,L.y-15,L.x,L.y-20,100),g.addLineTo(u.x,u.y-20),g.addArcTo(u.x-15,u.y-15,u.x-20,u.y,100),g.addLineTo(N.x-20,N.y),g.addArcTo(N.x-15,N.y+15,N.x,N.y+20,100),g.addLineTo(Y.x,Y.y+20),g.addArcTo(Y.x+15,Y.y+15,Y.x+20,Y.y,100);var w=new BABYLON.Vector2(-135,1135),f=new BABYLON.Vector2(-285,1135),m=new BABYLON.Vector2(-285,1485),y=new BABYLON.Vector2(-135,1485),M=new BABYLON.Path2(w.x+20,w.y);M.addArcTo(w.x+15,w.y-15,w.x,w.y-20,100),M.addLineTo(f.x,f.y-20),M.addArcTo(f.x-15,f.y+15,f.x-20,f.y,100),M.addLineTo(m.x-20,m.y),M.addArcTo(m.x-15,m.y+15,m.x,m.y+20,100),M.addLineTo(y.x,y.y+20),M.addArcTo(y.x+15,y.y-15,y.x+20,y.y,100);var C=new BABYLON.Vector2(-135,150),V=new BABYLON.Vector2(-285,150),S=new BABYLON.Vector2(0,200),T=new BABYLON.Vector2(-135,630),v=new BABYLON.Path2(C.x+20,C.y);v.addArcTo(C.x+15,C.y-15,C.x,C.y-20,100),v.addLineTo(V.x,V.y-20),v.addArcTo(V.x-15,V.y+15,V.x-20,V.y,100),v.addLineTo(S.x-305,S.y+220),v.addArcTo(S.x-170,S.y+435,S.x-165,S.y+440,100),v.addLineTo(T.x-30,T.y+10),v.addArcTo(T.x-5,T.y+10,T.x+20,T.y-30,100);var x=new BABYLON.Vector2(-135,-450),b=new BABYLON.Vector2(-135,-905),R=new BABYLON.Vector2(0,0),P=new BABYLON.Vector2(-285,-450),E=new BABYLON.Path2(x.x,x.y+20);E.addArcTo(x.x+15,x.y+15,x.x+20,x.y,100),E.addLineTo(b.x+20,b.y),E.addArcTo(b.x+15,b.y-15,b.x,b.y-20,100),E.addLineTo(R.x-135,R.y-925),E.addArcTo(R.x-210,R.y-855,R.x-305,R.y-705,100),E.addLineTo(P.x-20,P.y),E.addArcTo(P.x-15,P.y+15,P.x,P.y+20,100);var D=new BABYLON.Vector2(-135,-1330),W=new BABYLON.Vector2(-285,-1330),I=new BABYLON.Vector2(-285,-925),U=new BABYLON.Vector2(-455,-925),k=new BABYLON.Path2(D.x+20,D.y);k.addArcTo(D.x+15,D.y-15,D.x,D.y-20,100),k.addLineTo(W.x,W.y-20),k.addArcTo(W.x-15,W.y-15,W.x-20,W.y,100),k.addLineTo(I.x-20,I.y+50),k.addArcTo(I.x-15,I.y+65,I.x,I.y+70,100),k.addLineTo(U.x+170,U.y+70),k.addArcTo(U.x+275,U.y-15,U.x+340,U.y-210,100);var F=new BABYLON.Vector2(-285,1060),z=new BABYLON.Vector2(-135,1060),_=new BABYLON.Vector2(-135,690),H=new BABYLON.Vector2(-350,400),G=new BABYLON.Vector2(-285,580),$=new BABYLON.Path2(F.x-20,F.y);$.addArcTo(F.x-15,F.y+15,F.x,F.y+20,100),$.addLineTo(z.x,z.y+20),$.addArcTo(z.x+15,z.y+15,z.x+20,z.y,100),$.addLineTo(_.x+20,_.y),$.addArcTo(_.x+15,_.y-15,_.x,_.y-20,100),$.addLineTo(H.x+190,H.y+270),$.addArcTo(H.x+180,H.y+265,H.x+85,H.y+170,100),$.addLineTo(G.x+20,G.y-10),$.addArcTo(G.x,G.y-20,G.x-20,G.y,100);var j=new BABYLON.StandardMaterial("bawl",a),q=new BABYLON.GrassProceduralTexture("textbawl",300,a);j.ambientTexture=q,j.specularColor=new BABYLON.Color3.Black,j.backFaceCulling=!1;var Z=new BABYLON.PolygonMeshBuilder("polytri2",E.getPoints(),a).build(!1,2);Z.material=j,Z.position.y=-10,Z.isPickable=!1;var X=new BABYLON.PolygonMeshBuilder("polytri2",l.getPoints(),a).build(!1,2);X.material=j,X.position.y=-10,X.isPickable=!1;var K=new BABYLON.PolygonMeshBuilder("polytri2",k.getPoints(),a).build(!1,2);K.material=j,K.position.y=-10,K.isPickable=!1;var Q=new BABYLON.PolygonMeshBuilder("polytri2",g.getPoints(),a).build(!1,2);Q.material=j,Q.position.y=-10,Q.isPickable=!1;var J=new BABYLON.PolygonMeshBuilder("polytri2",O.getPoints(),a).build(!1,2);J.material=j,J.position.y=-10,J.isPickable=!1;var ee=new BABYLON.PolygonMeshBuilder("polytri2",M.getPoints(),a).build(!1,2);ee.material=j,ee.position.y=-10,ee.isPickable=!1;var ae=new BABYLON.PolygonMeshBuilder("polytri2",v.getPoints(),a).build(!1,2);ae.material=j,ae.position.y=-10,ae.isPickable=!1;var re=new BABYLON.PolygonMeshBuilder("polytri2",$.getPoints(),a).build(!0,2);re.material=j,re.position.y=-10,re.isPickable=!1,re.actionManager=new BABYLON.ActionManager(a);pe=new BABYLON.PlayAnimationAction(BABYLON.ActionManager.OnDoublePickTrigger,re,re.position,re.position.add(new BABYLON.Vector3(0,-20,0)),1e3);re.actionManager.registerAction(pe);var te=new BABYLON.PolygonMeshBuilder("polytri2",B.getPoints(),a).build(!1,2);te.material=j,te.position.y=-10,re.isPickable=!1;var ne=new BABYLON.GridMaterial("groundMaterial",a);ne.gridRatio=1,ne.majorUnitFrequency=5,ne.minorUnitVisibility=.2,ne.mainColor=new BABYLON.Color3(1,1,1),ne.lineColor=new BABYLON.Color3(1,1,1),ne.backFaceCulling=!1,ne.opacity=.6,ne.freeze(),ne.diffuseColor=new BABYLON.Color3(1,1,1),ne.maxSimultaneousLights=60;var ie=new BABYLON.StandardMaterial("StandardMaterial",a);ie.diffuseColor=new BABYLON.Color3(.3,.3,.3),ie.specularColor=new BABYLON.Color3(0,0,0),ie.emissiveColor=new BABYLON.Color3(0,0,0);var oe=new BABYLON.PolygonMeshBuilder("polytri",t,a);console.log("poly_path.getPoints",t.getPoints()),oe.addHole(B.getPoints()),oe.addHole(O.getPoints()),oe.addHole(g.getPoints()),oe.addHole(M.getPoints()),oe.addHole(l.getPoints()),oe.addHole(v.getPoints()),oe.addHole(E.getPoints()),oe.addHole(k.getPoints()),oe.addHole($.getPoints());var Be=oe.build(!1,0);Be.material=ne;var se,he,le,de=0;Be.actionManager=new BABYLON.ActionManager(a);var pe=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(e){de++;var r=a.pick(a.pointerX,a.pointerY).pickedPoint;he=new BABYLON.Vector3(r.x,1,r.z)}),ce=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(r){de++,le=a.pick(a.pointerX,a.pointerY).pickedPoint;var t=[];t.push(new BABYLON.Vector3(he.x,1,he.z)),t.push(new BABYLON.Vector3(he.x,1,le.z)),t.push(new BABYLON.Vector3(le.x,1,le.z)),t.push(new BABYLON.Vector3(le.x,1,he.z)),t.push(new BABYLON.Vector3(he.x,1,he.z)),se&&se.dispose(),(se=BABYLON.MeshBuilder.CreateDashedLines("dl",{points:t},a)).color=BABYLON.Color3.Black(),e.$broadcast("rectangle",[he,le])});return Be.actionManager.registerAction(pe).then(ce),Be.updateFacetData(),console.log("ground.facetNb",Be.facetNb),Be}function s(e){var a=new Array(6);a[0]=new BABYLON.Color4(1,0,0,.1),a[1]=new BABYLON.Color4(1,0,0,.1),a[2]=new BABYLON.Color4(1,0,0,.1),a[3]=new BABYLON.Color4(1,0,0,.1),a[4]=new BABYLON.Color4(1,0,0,.1),a[5]=new BABYLON.Color4(1,0,0,.1);var r={width:1400,height:500,depth:5600},t=BABYLON.MeshBuilder.CreateBox("box",r,e);t.hasVertexAlpha=!0,t.position.y=-250,t.isPickable=!1;var n=new BABYLON.GridMaterial("groundMaterial",e);return n.gridRatio=2,n.majorUnitFrequency=50,n.minorUnitVisibility=.2,n.mainColor=new BABYLON.Color3(1,1,1),n.backFaceCulling=!1,n.opacity=.6,t.material=n,t}function h(e,a,r,t){var n=new BABYLON.DynamicTexture("DynamicTexture",{width:300,height:100},t,!0);n.hasAlpha=!0,n.drawText(e,5,40,"36px Arial",a,"transparent",!0);var i=BABYLON.Mesh.CreatePlane("TextPlane",r,t,!0);return i.material=new BABYLON.StandardMaterial("TextPlaneMaterial",t),i.material.backFaceCulling=!1,i.material.specularColor=new BABYLON.Color3(1,0,0),i.material.diffuseTexture=n,i}function l(e,a){return e/Math.sqrt(1+Math.pow(a,2))}function d(e,a){return e*a/Math.sqrt(Math.pow(a,2)+1)}function p(e,a){var r=BABYLON.Mesh.CreateGroundFromHeightMap("ground","textures/aaa.png",5e3,5e3,600,-44,360,a,!1,function(e){},function(e){}),t=new BABYLON.StandardMaterial("groundMaterial",a);return t.diffuseTexture=new BABYLON.Texture("textures/guilin_baidu_map.png",a),t.specularColor=new BABYLON.Color3(0,0,0),t.freeze(),r.position.y=0,r.material=t,r.freezeWorldMatrix(),r}function c(e,a,r,t){var n=BABYLON.MeshBuilder.CreateGround("runway",{width:a/830*400,height:a,subdivsions:1},t),i=new BABYLON.StandardMaterial("ground",t);return i.diffuseTexture=new BABYLON.Texture("textures/tube_airport_map2.png",t),i.backFaceCulling=!1,i.specularColor=new BABYLON.Color3(0,0,0),n.position.x=30,n.rotation.y=-Math.PI/180/60/60*19464,n.material=i,n}function A(e,a,r,t){var n={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius};console.log("innerSurfaceParam:",n);var i=BABYLON.MeshBuilder.CreateCylinder("innerSurface",{height:n.height,diameterTop:n.diameterTop,diameterBottom:n.diameterBottom,tessellation:64,arc:.5,updatable:!1},t),o=new BABYLON.StandardMaterial("innerSurfaceMaterial",t);o.diffuseColor=new BABYLON.Color3(1,1,1),o.alpha=.6,i.position.y=n.height/2,o.wireframe=r,o.specularColor=new BABYLON.Color3(0,0,0);var B=i.clone(" halfInnerSurface2");B.rotation.y=Math.PI,i.position.z=-a/2,B.position.z=a/2;var s=[[new BABYLON.Vector3(n.diameterBottom/2,0,a/2),new BABYLON.Vector3(n.diameterTop/2,n.height,a/2),new BABYLON.Vector3(-n.diameterTop/2,n.height,a/2),new BABYLON.Vector3(-n.diameterTop/2,0,a/2)],[new BABYLON.Vector3(n.diameterBottom/2,0,-a/2),new BABYLON.Vector3(n.diameterTop/2,n.height,-a/2),new BABYLON.Vector3(-n.diameterTop/2,n.height,-a/2),new BABYLON.Vector3(-n.diameterTop/2,0,-a/2)]],h=BABYLON.MeshBuilder.CreateRibbon("innerSurfaceMiddle",{pathArray:s,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);h.wireframe=r;var l=BABYLON.Mesh.MergeMeshes([i,h,B]);return l.material=o,l}function O(e,a,r,t,n){var i={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius},o={height:a.height,diameterTop:i.diameterTop+a.height/a.slope*2,diameterBottom:i.diameterTop};console.log("cylinderParam:",o);var B=BABYLON.MeshBuilder.CreateCylinder("halfCylinder1",{height:o.height,diameterTop:o.diameterTop,diameterBottom:o.diameterBottom,tessellation:64,arc:.5,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n),s=new BABYLON.StandardMaterial("cylinderMaterial",n);s.diffuseColor=new BABYLON.Color3(210/255,105/255,30/255),s.alpha=.6,s.specularColor=new BABYLON.Color3(0,0,0),s.wireframe=t,B.position.y=i.height+o.height/2;var h=B.clone("halfCylinder2");h.rotation.y=Math.PI,B.position.z=-r/2,h.position.z=r/2;var l=[[new BABYLON.Vector3(o.diameterBottom/2,i.height,r/2),new BABYLON.Vector3(o.diameterBottom/2,i.height,-r/2)],[new BABYLON.Vector3(o.diameterTop/2,i.height+o.height,r/2),new BABYLON.Vector3(o.diameterTop/2,i.height+o.height,-r/2)],[new BABYLON.Vector3(-o.diameterTop/2,i.height+o.height,r/2),new BABYLON.Vector3(-o.diameterTop/2,i.height+o.height,-r/2)],[new BABYLON.Vector3(-o.diameterBottom/2,i.height,r/2),new BABYLON.Vector3(-o.diameterBottom/2,i.height,-r/2)]],d=BABYLON.MeshBuilder.CreateRibbon("cylinderSide",{pathArray:l,sideOrientation:BABYLON.Mesh.DOUBLESIDE,closeArray:!0},n),p=BABYLON.Mesh.MergeMeshes([B,d,h]);return p.material=s,p}function L(e,a,r){var t=a/2+e.distance,n=a/2+e.distance+l(e.length,e.slope),i=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2,d(e.length,e.slope),r?n:r-n)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-e.innerWidth/2,d(e.length,e.slope),r?n:r-n)]];return console.log("innerApproachSurfacePaths:",i),i}function u(e,a,r,t,n){var i=L(e,a,0),o=L(e,a,1),B=new BABYLON.StandardMaterial("innerApproachSurfaceMateria1",t);B.diffuseColor=new BABYLON.Color3(128/255,0,0),B.alpha=.6,B.specularColor=new BABYLON.Color3(0,0,0);var s=BABYLON.MeshBuilder.CreateRibbon("innerApproachSurface1",{pathArray:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);s.material=B;var h=BABYLON.MeshBuilder.CreateRibbon("innerApproachSurface2",{pathArray:o,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);return h.material=B,[s,h]}function N(e,a,r){console.log("approachSurfaceRef",e);var t=a/2+e.distance,n=a/2+e.distance+l(e.phase1.length,e.phase1.slope),i=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,d(e.phase1.length,e.phase1.slope),r?n:r-n)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),d(e.phase1.length,e.phase1.slope),r?n:r-n)]],o=a/2+e.distance+l(e.phase1.length,e.phase1.slope),B=a/2+e.distance+l(e.phase1.length,e.phase1.slope)+l(e.phase2.length,e.phase2.slope),s=[[new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,d(e.phase1.length,e.phase1.slope),r?o:r-o),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate,d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope),r?B:r-B)],[new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),d(e.phase1.length,e.phase1.slope),r?o:r-o),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate),d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope),r?B:r-B)]],h=a/2+e.distance+l(e.phase1.length,e.phase1.slope)+l(e.phase2.length,e.phase2.slope),p=a/2+e.distance+l(e.phase1.length,e.phase1.slope)+l(e.phase2.length,e.phase2.slope)+l(e.phase3.length,e.phase3.slope);return[i,s,[[new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate,d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope),r?h:r-h),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate+e.phase3.length*e.dispersalRate,d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope)+d(e.phase3.length,e.phase3.slope),r?p:r-p)],[new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate),d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope),r?h:r-h),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate+e.phase2.length*e.dispersalRate+e.phase3.length*e.dispersalRate),d(e.phase1.length,e.phase1.slope)+d(e.phase2.length,e.phase2.slope)+d(e.phase3.length,e.phase3.slope),r?p:r-p)]]]}function Y(e,a,r,t){var n=N(e,a,0),i=N(e,a,1),o=new BABYLON.StandardMaterial("approachSurfacePhase1Materia1",t);o.diffuseColor=new BABYLON.Color3(1,105/255,180/255),o.alpha=.6,o.wireframe=r,o.specularColor=new BABYLON.Color3(0,0,0);var B=new BABYLON.StandardMaterial("approachSurfacePhase2Material",t);B.diffuseColor=new BABYLON.Color3(1,105/255,180/255),B.alpha=.6,B.wireframe=r,B.specularColor=new BABYLON.Color3(0,0,0);var s=new BABYLON.StandardMaterial("approachSurfacePhase3Materia",t);s.diffuseColor=new BABYLON.Color3(1,105/255,180/255),s.alpha=.6,s.wireframe=r,s.specularColor=new BABYLON.Color3(0,0,0);var l=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase1",{pathArray:n[0],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);l.material=o;var d=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase2",{pathArray:n[1],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);d.material=B;var p=BABYLON.MeshBuilder.CreateRibbon("approachSurface1Phase3",{pathArray:n[2],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);p.material=s;var c=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase1",{pathArray:i[0],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);c.material=o;var A=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase2",{pathArray:i[1],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);A.material=B;var O=BABYLON.MeshBuilder.CreateRibbon("approachSurface2Phase3",{pathArray:i[2],sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);return O.material=s,h("近进面","red",100,t).position=new BABYLON.Vector3(0,e.phase1.length*e.phase1.slope+e.phase2.length*e.phase2.slope,a/2+e.distance+e.phase1.length+e.phase2.length),[[l,d,p],[c,A,O]]}function g(e,a,r,t){var n=[[new BABYLON.Vector3(e.innerWidth/2,0,a/2+e.distance),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,e.phase1.length*e.phase1.slope,a/2+e.distance+e.phase1.length),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),e.phase1.length*e.phase1.slope,a/2+e.distance+e.phase1.length),new BABYLON.Vector3(-e.innerWidth/2,0,a/2+e.distance)],[new BABYLON.Vector3(e.innerWidth/2,0,-(a/2+e.distance)),new BABYLON.Vector3(e.innerWidth/2+e.phase1.length*e.dispersalRate,e.phase1.length*e.phase1.slope,-(a/2+e.distance+e.phase1.length)),new BABYLON.Vector3(-(e.innerWidth/2+e.phase1.length*e.dispersalRate),e.phase1.length*e.phase1.slope,-(a/2+e.distance+e.phase1.length)),new BABYLON.Vector3(-e.innerWidth/2,0,-(a/2+e.distance))]],i=BABYLON.MeshBuilder.CreateRibbon("transitionalSurface",{pathArray:n,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t),o=new BABYLON.StandardMaterial("transitionalSurfaceMaterial",t);return o.diffuseColor=new BABYLON.Color3(34/255,139/255,34/255),o.alpha=.6,o.specularColor=new BABYLON.Color3(0,0,0),i.material=o,i.wireframe=r,i}function w(e,a,r,t){var n=r/2+a.distance,i=e.diameterTop,o=[[new BABYLON.Vector3(a.innerWidth/2,0,t?n:t-n),new BABYLON.Vector3(a.innerWidth/2+e.height/a.dispersalRate,e.height,t?i:t-i)],[new BABYLON.Vector3(-a.innerWidth/2,0,t?n:t-n),new BABYLON.Vector3(-(a.innerWidth/2+e.height/a.dispersalRate),e.height,t?i:t-i)]];return console.log("reFlySurfacePaths:",o),o}function f(e,a,r,t,n){var i={height:e.height,diameterTop:2*e.radius,diameterBottom:2*e.radius},o=w(i,a,r,0),B=w(i,a,r,1),s=new BABYLON.StandardMaterial("reFlySurfaceMateria1",n);s.diffuseColor=new BABYLON.Color3(128/255,0,0),s.alpha=.6,s.specularColor=new BABYLON.Color3(0,0,0),s.wireframe=t;var l=BABYLON.MeshBuilder.CreateRibbon("reFlySurface1",{pathArray:o,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);l.material=s;var d=BABYLON.MeshBuilder.CreateRibbon("reFlySurface2",{pathArray:B,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n);return d.material=s,h("复飞面","red",100,n).position=new BABYLON.Vector3(0,i.height,-i.diameterTop),[l,d]}function m(e,a,r){var t=a/2+e.distance,n=a/2+e.distance+l(e.length,e.slope),i=[[new BABYLON.Vector3(e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(e.innerWidth/2+e.length*e.dispersalRate,d(e.length,e.slope),r?n:r-n)],[new BABYLON.Vector3(-e.innerWidth/2,0,r?t:r-t),new BABYLON.Vector3(-(e.innerWidth/2+e.length*e.dispersalRate),d(e.length,e.slope),r?n:r-n)]];return console.log("flySurfacePaths:",i),i}function y(e,a,r,t){var n=m(e,a,0),i=m(e,a,1),o=new BABYLON.StandardMaterial("flySurfaceMateria1",t);o.diffuseColor=new BABYLON.Color3(1,160/255,122/255),o.alpha=.6,o.specularColor=new BABYLON.Color3(0,0,0),o.wireframe=r;var B=BABYLON.MeshBuilder.CreateRibbon("flySurface",{pathArray:n,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);B.material=o;var s=BABYLON.MeshBuilder.CreateRibbon("flySurface",{pathArray:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE},t);return s.material=o,h("起飞爬升面","red",100,t).position=new BABYLON.Vector3(0,e.length*e.slope,-(a/2+e.distance+e.length)),[B,s]}var M,C,V;return{createScene:function(e,i,o){V=i,t(e,M=new BABYLON.Scene(i)),n(M);new BABYLON.HighlightLayer("hl1",M);return a(M,o),r(100,M),window.addEventListener("resize",function(){i.resize()}),M},createHeightMapGround:p,createUnderGroundBox:s,createPH:i,createGround:B,createAirefieldBoarder:o,createRunway:c,createInnerHorizontalSurface:A,createCylinderSurface:O,createInnerApproachSurfaces:u,createApproachSurfaces:Y,createTransitionalSurfaces:g,createReflySurfaces:f,createFlySurfaces:y,getXfromH:function(e){return 20*(e-35)-700},getZfromP:function(e){return 20*(e-35)-2800},getHfromX:function(e){return(e+700)/20+35},getPfromZ:function(e){return(e+2800)/20+35}}}angular.module("ngBabylonjs").factory("AirfieldScene",e),e.$inject=["$rootScope","SkyBox","WorldAxis"]})();
